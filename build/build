#!/usr/bin/env bash

set -e

# Builds 'service-mail' docker image with the version given below. 

# Determine the build_tag and whether we need to release.
scripts/build_name
version=$(cat build_tag)

mkdir -p mail/bin
rsync -a ../ bin \
  --exclude node_modules \
  --exclude .github \
  --exclude build \
  --exclude config \
  --exclude test \
  --exclude .gitignore

host='eu.gcr.io'

echo "---------------------------- building mail ------------------------------"
pushd mail
docker build -f Dockerfile -t $host/pryvio/mail:$version .
docker push $host/pryvio/mail:$version
popd
